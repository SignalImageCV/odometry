function val = sampson(q,t,x1,x2)

% q - unit quaternion that represents rotation

N = size(x1,2);

R = quaternion(q).RotationMatrix;

E = skew(t)*R;
val = 0;
for i=1:N
    p1 = x1(:,i);
    p2 = x2(:,i);
    
    p2tE = p2'*E;
    Ep1  = E*p1;
    
    ri = p2'*skew(t)*R*p1/sqrt(p2tE(1)^2 + (p2tE(1))^2 + (Ep1(1))^2 + (Ep1(2))^2);
    val = val + ri*ri;
end
end


